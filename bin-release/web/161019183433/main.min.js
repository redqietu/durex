var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),r=i.prototype;return r.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},r.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),r=i.prototype;return r.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},r.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},r.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},r.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},r.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},r.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},r.createGameScene=function(){this.createGameScene1()},r.createGameScene1=function(){var e=this,t=new egret.DisplayObjectContainer,i=new egret.Shape,r=this.stage.stageWidth,a=this.stage.stageHeight;i.graphics.beginFill(16767502,1),i.graphics.drawRect(0,0,r,a),i.graphics.endFill(),t.addChild(i);var n=this.createBitmapByName("bk-sanshe_png");t.addChild(n);var o=this.createBitmapByName("bk-dian_png");t.addChild(o);var s=this.createBitmapByName("bk-p1_png");t.addChild(s);var l=this.createBitmapByName("left_png"),d=this.createBitmapByName("right_png");l.x=0,l.y=658,t.addChild(l),d.x=r-141,d.y=658,t.addChild(d);var h=this.createBitmapByName("icon-emao_png");t.addChild(h);var c=this.createBitmapByName("btn-lijixiaheishou_png");t.addChild(c),c.x=82,c.y=995,this.addChild(t),c.touchEnabled=!0,c.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){TweenMax.to(t,1,{x:-1e3,y:-1e3,scale:0,opacity:0,rotation:-100,ease:Back.easeInOut,onComplete:function(){e.removeChild(t)}}),e.createGameScene2(),e.setChildIndex(t,t.numChildren-1)},this,!0)},r.createGameScene2=function(){var e=new egret.DisplayObjectContainer,t=this.createBitmapByName("bk-p2_png");e.addChild(t);var i=new TimelineMax({onComplete:function(){P2App.getInstance(e)}});i.fromTo(t,1,{x:1e3,y:1e3,alpha:0,rotation:100,ease:Back.easeOut,scaleX:9,scaleY:9},{x:0,y:0,rotation:0,alpha:1,ease:Back.easeInOut,scaleX:9,scaleY:9}).fromTo(t,1,{scaleX:9,scaleY:9,data_filter:1,alpha:0},{scaleX:1,scaleY:1,data_filter:0,alpha:1}),this.addChild(e)},r.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},r.startAnimation=function(e){for(var t=this,i=new egret.HtmlTextParser,r=[],a=0;a<e.length;a++)r.push(i.parser(e[a]));var n=t.textfield,o=-1,s=function(){o++,o>=r.length&&(o=0);var e=r[o];t.changeDescription(n,e);var i=egret.Tween.get(n);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(s,t)};s()},r.changeDescription=function(e,t){e.textFlow=t},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var P2App=function(){function e(t){this.bodyType=p2.Body.DYNAMIC,this.world=e.world,this.factor=50,this.stageWidth=egret.MainContext.instance.stage.stageWidth,this.stageHeight=egret.MainContext.instance.stage.stageHeight,this.scoreLabel=new egret.TextField,this.deadlineLabel=new egret.TextField,this.container=t,e.world.sleepMode=p2.World.BODY_SLEEPING,this.createScore(),this.createDeadline(),this.createGround(),this.loop()}var t=(__define,e),i=t.prototype;return i.createScore=function(){this.container.addChild(this.scoreLabel),this.setScore(e.score=0),this.scoreLabel.x=this.stageWidth-200,this.scoreLabel.y=30,this.scoreLabel.textColor=14685975},i.createDeadline=function(){this.container.addChild(this.deadlineLabel),this.setDeadline(this.deadline=60),this.deadlineLabel.x=this.stageWidth/2-100,this.deadlineLabel.textColor=16777215,this.deadlineLabel.size=60},i.setScore=function(e){this.scoreLabel.text="Score:"+e},i.setDeadline=function(e){60==e?this.deadlineLabel.text="01:00":(9>=e&&(e="0"+e),this.deadlineLabel.text="00:"+e)},e.getInstance=function(t){return e.instance?e.instance:new e(t)},i.createDurex=function(t,i,r){var a=this.createBitmapByName(i,r);a.x=Math.random()*(this.stageWidth-120),a.y=Math.random()*(this.stageHeight-1e3);var n=new p2.Body({mass:100*Math.random(),position:[a.x/this.factor,a.y/this.factor],force:[0,-100],density:10*Math.random(),damping:e.damping,angularVelocity:10,type:this.bodyType});n.addShape(new p2.Box({width:84/this.factor,height:180/this.factor})),n.userData=a,a.__body=n,a.addEventListener(egret.TouchEvent.TOUCH_TAP,t,{display:a,p2app:this}),a.touchEnabled=!0,this.world.addBody(n),this.container.addChild(a)},i.createGround=function(){var e=new p2.Plane({}),t=new p2.Body({position:[0,1]});t.addShape(e),this.world.addBody(t)},i.createBitmapByName=function(e,t){var i=new egret.Bitmap,r=RES.getRes(e);return i.texture=r,i.__textureName=e,t&&(i.__anotherTextureName=t),i},i.loop=function(){var t=0,i=function(t){this.display.__body.userData=this.p2app.createBitmapByName(this.display.__anotherTextureName),this.p2app.container.removeChild(this.display),this.p2app.container.addChild(this.display.__body.userData),this.p2app.setScore(++e.score)},r=function(t){var i=e.world;i.step(t/1e3);egret.MainContext.instance.stage.stageHeight,i.bodies.length;i.bodies.forEach(function(e){var t=e.userData;t&&(t.x=e.position[0]*this.factor,t.y=e.position[1]*this.factor,t.rotation=e.angle)},this)};egret.Ticker.getInstance().register(r,this);var a=new egret.Timer(200,300);a.addEventListener(egret.TimerEvent.TIMER,function(r){var a=this.random(1,3);t++,t%5===0&&this.setDeadline(--e.deadline),this.createDurex(i,"tt"+a+"_png","xtt"+a+"_png")},this),a.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(e){egret.Ticker.getInstance().unregister(r,null)},this),a.start()},i.random=function(e,t){var i=t-e,r=Math.random();return e+Math.round(r*i)},e.damping=.5,e.gravity=[0,9],e.world=new p2.World({gravity:e.gravity}),e.score=0,e.deadline=60,e}();egret.registerClass(P2App,"P2App");var p2DebugDraw=function(){function e(e){this.COLOR_D_SLEEP=10066329,this.COLOR_D_WAKE=15053490,this.COLOR_K=10329589,this.COLOR_S=8381823,this.lineWidth=1,this.world=e}var t=(__define,e),i=t.prototype;return i.setSprite=function(e){this.sprite=e},i.setLineWidth=function(e){this.lineWidth=e},i.drawDebug=function(){this.sprite.graphics.clear();for(var e=this.world.bodies.length,t=0;e>t;t++)for(var i=this.world.bodies[t],r=0;r<i.shapes.length;r++){var a=i.shapes[r];a instanceof p2.Box?this.drawBox(a,i):a instanceof p2.Convex?this.drawConvex(a,i):a instanceof p2.Circle?this.drawCircle(a,i):a instanceof p2.Line?this.drawLine(a,i):a instanceof p2.Particle?this.drawParticle(a,i):a instanceof p2.Plane?this.drawPlane(a,i):a instanceof p2.Capsule?this.drawCapsule(a,i):a instanceof p2.Heightfield&&this.drawHeightfield(a,i)}},i.drawRay=function(e,t,i){var r=this.sprite.graphics;r.lineStyle(this.lineWidth,i),r.moveTo(e[0],e[1]),r.lineTo(t[0],t[1]),r.endFill()},i.drawBox=function(e,t){this.drawConvex(e,t)},i.drawCircle=function(e,t){var i=this.getColor(t),r=this.sprite.graphics;r.lineStyle(this.lineWidth,i),r.beginFill(i,.5);var a=e.position[0],n=e.position[1],o=[];t.toWorldFrame(o,[a,n]),r.drawCircle(o[0],o[1],e.radius);var s=a+e.radius,l=n+0,d=new Array;t.toWorldFrame(d,[s,l]),r.moveTo(o[0],o[1]),r.lineTo(d[0],d[1]),r.endFill()},i.drawCapsule=function(e,t){var i=this.getColor(t),r=e.position[0],a=e.position[1],n=e.angle,o=e.length,s=e.radius,l=new Array,d=new Array,h=new Array,c=new Array,p=new Array,g=new Array;p2.vec2.rotate(l,[-o/2,-s],n),p2.vec2.rotate(d,[o/2,-s],n),p2.vec2.rotate(h,[o/2,s],n),p2.vec2.rotate(c,[-o/2,s],n),p2.vec2.rotate(p,[o/2,0],n),p2.vec2.rotate(g,[-o/2,0],n);var u=new Array,v=new Array,m=new Array,f=new Array,E=new Array,y=new Array;t.toWorldFrame(u,[r+l[0],a+l[1]]),t.toWorldFrame(v,[r+d[0],a+d[1]]),t.toWorldFrame(m,[r+h[0],a+h[1]]),t.toWorldFrame(f,[r+c[0],a+c[1]]),t.toWorldFrame(E,[r+p[0],a+p[1]]),t.toWorldFrame(y,[r+g[0],a+g[1]]);var C=this.sprite.graphics;C.lineStyle(this.lineWidth,i),C.beginFill(i,.5),C.drawCircle(E[0],E[1],s),C.endFill(),C.lineStyle(this.lineWidth,i),C.beginFill(i,.5),C.drawCircle(y[0],y[1],s),C.endFill(),C.lineStyle(this.lineWidth,i),C.beginFill(i,.5),C.moveTo(u[0],u[1]),C.lineTo(v[0],v[1]),C.lineTo(m[0],m[1]),C.lineTo(f[0],f[1]),C.endFill()},i.drawLine=function(e,t){var i=this.getColor(t),r=e.position[0],a=e.position[1],n=e.angle,o=e.length,s=new Array,l=new Array;p2.vec2.rotate(s,[-o/2,0],n),p2.vec2.rotate(l,[o/2,0],n);var d=[],h=[];t.toWorldFrame(d,[r+s[0],a+s[1]]),t.toWorldFrame(h,[r+l[0],a+l[1]]);var c=this.sprite.graphics;c.lineStyle(this.lineWidth,i),c.moveTo(d[0],d[1]),c.lineTo(h[0],h[1]),c.endFill()},i.drawHeightfield=function(e,t){var i=this.getColor(t),r=e.heights,a=r.length,n=e.elementWidth;if(a>0){var o=e.position[0],s=e.position[1],l=[],d=[],h=0,c=this.sprite.graphics;c.lineStyle(this.lineWidth,i),c.beginFill(i,.5),t.toWorldFrame(d,[o+h,s-100]),c.moveTo(d[0],d[1]);for(var p=0;a>p;p++){var g=r[p];t.toWorldFrame(l,[o+h+p*n,s+g]),c.lineTo(l[0],l[1])}t.toWorldFrame(l,[o+h+a*n,s-100]),c.lineTo(l[0],l[1]),c.endFill()}},i.drawParticle=function(e,t){var i=this.getColor(t),r=this.sprite.graphics;r.lineStyle(this.lineWidth,i),r.beginFill(i,.5);var a=e.position[0],n=e.position[1],o=t.position[0]+a,s=t.position[1]+n;r.drawCircle(o,s,this.lineWidth),r.endFill(),r.lineStyle(this.lineWidth,i),r.drawCircle(o,s,5*this.lineWidth),r.endFill()},i.drawConvex=function(e,t){var i=this.getColor(t),r=e.vertices.length,a=this.sprite.graphics;a.lineStyle(this.lineWidth,i),a.beginFill(i,.5);var n=e.position[0],o=e.position[1],s=new Array;t.toWorldFrame(s,[n,o]);var l=e.vertices[0],d=[n+l[0],o+l[1]],h=new Array;t.toWorldFrame(h,d),a.moveTo(s[0],s[1]),a.lineTo(h[0],h[1]);for(var c=1;r>=c;c++)l=e.vertices[c%r],d=[n+l[0],o+l[1]],t.toWorldFrame(h,d),a.lineTo(h[0],h[1]);a.endFill()},i.drawPlane=function(e,t){var i=this.COLOR_D_SLEEP,r=this.sprite.graphics;r.lineStyle(this.lineWidth,i),r.beginFill(i,1);var a=e.position[0],n=e.position[1],o=e.angle,s=new Array,l=new Array,d=[],h=[];p2.vec2.rotate(s,[-1e3,0],o),t.toWorldFrame(d,[a+s[0],n+s[1]]),r.moveTo(d[0],d[1]),p2.vec2.rotate(l,[1e3,0],o),t.toWorldFrame(h,[a+l[0],n+l[1]]),r.lineTo(h[0],h[1]),p2.vec2.rotate(l,[1e3,-1e3],o),t.toWorldFrame(h,[a+l[0],n+l[1]]),r.lineTo(h[0],h[1]),p2.vec2.rotate(l,[-1e3,-1e3],o),t.toWorldFrame(h,[a+l[0],n+l[1]]),r.lineTo(h[0],h[1]),p2.vec2.rotate(l,[-1e3,-0],o),t.toWorldFrame(h,[a+l[0],n+l[1]]),r.lineTo(h[0],h[1]),r.endFill()},i.getColor=function(e){var t=this.COLOR_D_SLEEP;return e.type==p2.Body.KINEMATIC?t=this.COLOR_K:e.type==p2.Body.STATIC?t=this.COLOR_S:e.sleepState==p2.Body.AWAKE&&(t=this.COLOR_D_WAKE),t},e}();egret.registerClass(p2DebugDraw,"p2DebugDraw");