var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),n=i.prototype;return n.createView=function(){var e=egret.MainContext.instance.stage.stageWidth,t=egret.MainContext.instance.stage.stageHeight;this.bg=new egret.Shape,this.bg.graphics.beginFill(9566706,1),this.bg.graphics.drawRect(0,0,e,t),this.bg.graphics.endFill(),this.addChild(this.bg),this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=500,this.textField.width=e,this.textField.height=100,this.textField.textColor=0,this.textField.textAlign="center",this.textfield=new egret.TextField,this.addChild(this.textfield),this.textfield.y=532,this.textfield.width=e,this.textfield.height=100,this.textfield.textColor=0,this.textfield.textAlign="center"},n.setProgress=function(e,t){this.textfield.text="加载了"+e+"个,还剩"+(t-e)+"个",this.textField.text="猫哥正在为您拼命加载游戏资源..."},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.call(this),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}__extends(t,e);var i=(__define,t),n=i.prototype;return n.onAddToStage=function(e){this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},n.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},n.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene())},n.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},n.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},n.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},n.createGameScene=function(){this.createGameScene1()},n.createGameScene1=function(){var e=this,t=new egret.DisplayObjectContainer,i=new egret.Shape,n=this.stage.stageWidth,a=this.stage.stageHeight;i.graphics.beginFill(9108468,1),i.graphics.drawRect(0,0,n,a),i.graphics.endFill(),t.addChild(i);var s=this.createBitmapByName("bk-p1_png");t.addChild(s);var h=this.createBitmapByName("icon-emao_png");t.addChild(h),h.y=6,h.x=0;var r=this.createBitmapByName("btn-lijixiaheishou_png");t.addChild(r),r.x=273,r.y=1094,this.addChild(t),r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){TweenMax.to(t,1,{x:-1e3,y:-1e3,scale:0,appha:0,rotation:-100,ease:Back.easeInOut,onComplete:function(){e.removeChild(t)}}),e.createGameScene2(),e.setChildIndex(t,t.numChildren-1)},this,!0)},n.createGameScene2=function(){new P2Scene(P2Scene.scene,this.stage)},n.createGameScene3=function(){new P3Scene(P3Scene.scene,this.stage)},n.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},n.startAnimation=function(e){for(var t=this,i=new egret.HtmlTextParser,n=[],a=0;a<e.length;a++)n.push(i.parser(e[a]));var s=t.textfield,h=-1,r=function(){h++,h>=n.length&&(h=0);var e=n[h];t.changeDescription(s,e);var i=egret.Tween.get(s);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(r,t)};r()},n.changeDescription=function(e,t){e.textFlow=t},t}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var P2Scene=function(){function e(t,i){var n=this;this.scene=e.scene,this.bodyType=p2.Body.DYNAMIC,this.world=e.world,this.factor=50,this.stageWidth=egret.MainContext.instance.stage.stageWidth,this.stageHeight=egret.MainContext.instance.stage.stageHeight,this.scoreLabel=new egret.TextField,this.deadlineLabel=new egret.TextField,this.flag=!1,this.container=t,this.stage=i,this.createScene();var a=e.world.bodies.slice();a.forEach(function(t){e.world.removeBody(t)}),e.world.sleepMode=p2.World.BODY_SLEEPING,this.createScore(),this.show(function(){return n.loop()}),this.createDeadline(),this.createGround(),e.stageHeight=egret.MainContext.instance.stage.$stageHeight,e.stageWidth=egret.MainContext.instance.stage.$stageWidth}var t=(__define,e),i=t.prototype;return i.createScore=function(){this.container.addChild(this.scoreLabel),this.setScore(e.score=0),this.scoreLabel.x=this.stageWidth-140,this.scoreLabel.y=50,this.scoreLabel.textColor=16777215},i.createDeadline=function(){this.container.addChild(this.deadlineLabel),this.setDeadline(this.deadline=e.TIME),this.deadlineLabel.x=this.stageWidth/2-80,this.deadlineLabel.y=30,this.deadlineLabel.textColor=16777215,this.deadlineLabel.size=60},i.setScore=function(e){this.scoreLabel.text="击中："+e},i.setDeadline=function(e){e%60==0?this.deadlineLabel.text="0"+Math.floor(e/60)+":00":(9>=e&&(e="0"+e),this.deadlineLabel.text="00:"+e)},e.getInstance=function(t,i){return e.instance?e.instance:new e(t,i)},i.createDurex=function(e,t,i){var n=this.createBitmapByName(t,i);n.x=Math.random()*this.stageWidth-77,n.y=-215;var a=new p2.Body({mass:100,position:[n.x/this.factor,(this.stageHeight-n.y)/this.factor],angle:.03*(180*Math.random()-180),velocity:[0,40*-Math.random()],fixedX:!0,type:this.bodyType});a.addShape(new p2.Box({width:77/this.factor,height:215/this.factor})),a.userData=n,n.__body=a,n.addEventListener(egret.TouchEvent.TOUCH_TAP,e,{display:n,P2Scene:this}),n.touchEnabled=!0,this.world.addBody(a),this.container.addChild(n),this.container.swapChildren(n,this.ad)},i.createGround=function(){var e=new p2.Plane({}),t=new p2.Body({mass:0,position:[0,-1e3]});t.addShape(e),this.world.addBody(t)},i.createBitmapByName=function(e,t){var i=new egret.Bitmap,n=RES.getRes(e);return i.texture=n,i.__textureName=e,t&&(i.__anotherTextureName=t),i},i.loop=function(){var t=0,i=this,n=function(t){i.flag||(this.display.__body.userData=this.P2Scene.createBitmapByName(this.display.__anotherTextureName),this.P2Scene.container.removeChild(this.display),this.P2Scene.container.addChild(this.display.__body.userData),this.P2Scene.setScore(++e.score))},a=function(t){if(!i.flag){var n=e.world;n.step(t/1e3);egret.MainContext.instance.stage.stageHeight,n.bodies.length;n.bodies.forEach(function(t){var i=t.userData;i&&(i.x=t.position[0]*this.factor,i.y=e.stageHeight-t.position[1]*this.factor,i.rotation=t.angle)},this)}},s=egret.Ticker.getInstance();s.register(a,this);var h=new egret.Timer(200,5*e.TIME);h.addEventListener(egret.TimerEvent.TIMER,function(i){this.random(1,3);t++,t%5===0&&this.setDeadline(--e.deadline),this.createDurex(n,"tt1_png","xtt1_png")},this),h.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(t){document.querySelector("title").innerHTML="恭喜，您共摘到"+e.score+"朵桃花，看来要走桃花运～_一猫汽车网",s.unregister(a,null),this.alert(e.score)},this),h.start()},i.random=function(e,t){var i=t-e,n=Math.random();return e+Math.round(n*i)},i.alert=function(e){var t=this;void 0===e&&(e=0),this.flag=!0;var i=new egret.DisplayObjectContainer;this.dialog=this.createBitmapByName("dialog_png"),i.addChild(this.dialog),this.dialog.x=95,this.dialog.y=338;var n=new egret.TextField;n.text="恭喜您摘到"+e+"朵桃花";var a=new egret.TextField;a.text="看来您要走桃花运~",n.textAlign="center",a.textAlign="center",n.width=686,a.width=686,n.size=50,a.size=50,n.textColor=16760271,a.textColor=16760271,n.y=430,a.y=490,n.x=32,a.x=32,this.btn_queding=this.createBitmapByName("btn-queding_png"),this.btn_queding.y=560,this.btn_queding.x=288,i.addChild(this.btn_queding),this.btn_queding.touchEnabled=!0,this.btn_queding.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){TweenMax.to(i,1,{x:-1e3,y:-1e3,scale:0,opacity:0,rotation:-100,ease:Back.easeInOut,onComplete:function(){new P3Scene(P3Scene.scene,t.stage),P3Scene.scene.x=0,P3Scene.scene.y=0,P3Scene.scene.alpha=1,P3Scene.scene.rotation=0,TweenMax.from(P3Scene.scene,.8,{x:-100,y:-100,scale:.4,alpha:0,rotation:-100,ease:Back.easeInOut,yoyo:!0})}})}),i.addChild(n),i.addChild(a),this.scene.addChild(i),i.x=0,i.y=0,TweenMax.from(i,1,{y:100,alpha:0})},i.createScene=function(){var t=e.scene;t.removeChildren(),t.x=0,t.y=0;var i=this.createBitmapByName("bk-p2_png"),n=this.createBitmapByName("ad_png");this.ad=n,i.x=0,i.y=0,window.__height=window.__height||this.stage.height,i.height=window.__height-240,n.x=0,n.y=window.__height-240,n.width=750,n.height=240;var a=new egret.Shape,s=[this.createBitmapByName("n3_png"),this.createBitmapByName("n2_png"),this.createBitmapByName("n1_png")],h=s[0],r=s[1],o=s[2];h.x=370,h.y=499,r.x=370,r.y=499,o.x=370,o.y=499,h.anchorOffsetX=43,h.anchorOffsetY=43,r.anchorOffsetX=43,r.anchorOffsetY=43,o.anchorOffsetX=43,o.anchorOffsetY=43,a.graphics.beginFill(0,1),a.graphics.drawRect(0,0,this.stage.width,window.__height-240),a.graphics.endFill(),t.addChild(i),t.addChild(n),t.addChild(a),t.swapChildren(a,this.ad),t.addChild(h),t.addChild(r),t.addChild(o),this.stage.addChild(t),this.stage.setChildIndex(t,t.numChildren-3),this.mask=a,this.djs1=h,this.djs2=r,this.djs3=o},i.show=function(e){var t=this.scene,i=this.mask,n=this.djs1,a=this.djs2,s=this.djs3,h=new TimelineMax({onComplete:function(){e()}});h.fromTo(i,.2,{alpha:0},{alpha:.7}).staggerFromTo([n,a,s],1,{alpha:0,scaleX:1.6,scaleY:1.6,ease:Power4.easeInOut},{alpha:1,scaleX:.6,scaleY:.6,ease:Power4.easeInOut,onComplete:function(){TweenMax.to(this.target,.2,{alpha:0,onComplete:function(){t.removeChild(this.target)}})}},1)},e.damping=.5,e.gravity=[0,-2],e.world=new p2.World({gravity:e.gravity}),e.scene=new egret.DisplayObjectContainer,e.score=0,e.TIME=30,e.deadline=e.TIME,e}();egret.registerClass(P2Scene,"P2Scene");var P3Scene=function(){function e(e,t){this.cst(e,t),this.init(),this.createView(),this.bindEvent()}var t=(__define,e),i=t.prototype;return e.getInstance=function(t,i){return e.instance?e.instance:new e(t,i)},i.cst=function(e,t){this.scene=e,this.stage=t,this.stageWidth=this.stage.stageWidth,this.stageHeight=this.stage.stageHeight},i.init=function(){this.stage.addChild(this.scene)},i.createLayer=function(e){var t=this,i=new egret.DisplayObjectContainer;this.stage.addChild(i);var n=new egret.Shape;n.graphics.beginFill(0,1),n.graphics.drawRect(0,0,this.stageWidth,this.stageHeight),n.graphics.endFill(),n.alpha=.8,i.addChild(n),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},i,!1);var a=this.createBitmapByName("layer-share_png");a.x=0,a.y=0;var s=this.createBitmapByName("btn-close_png");s.x=23,s.y=22,i.addChild(s),i.addChild(a),s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.stage.removeChild(i)},i,!1)},i.createView=function(){var e=this.createBitmapByName("bk-dian_png"),t=new egret.Shape;t.graphics.beginFill(9029358,1),t.graphics.drawRect(0,0,this.stageWidth,this.stageHeight),t.graphics.endFill(),this.scene.addChild(t),this.scene.addChild(e);var i=this.createBitmapByName("xinzhi_png");this.scene.addChild(i);var n=this.createBitmapByName("icon-emao_png");n.y=22,n.x=29,this.logo=n;var a=this.createBitmapByName("ad_png");this.ad=a,window.__height=window.__height||this.stage.height,a.x=0,a.y=window.__height-240,a.width=750,a.height=240,this.scene.addChild(a);var s=this.createBitmapByName("tts_png");this.scene.addChild(s),s.y=290,s.x=64,s.height=620;var h=this.createBitmapByName("xinfeng_png");this.scene.addChild(h),h.y=866,h.x=0;var r=this.createBitmapByName("btn-1_png");this.scene.addChild(r),r.y=870,r.x=84,this.btn1=r;var o=this.createBitmapByName("btn-2_png");this.scene.addChild(o),o.y=870,o.x=429,this.btn2=o;var d=this.createBitmapByName("btn-3_png");this.scene.addChild(d),d.y=959,d.x=263,this.btn3=d;var c=this.createBitmapByName("shou--left_png");this.scene.addChild(c),c.y=963,c.x=0;var l=this.createBitmapByName("shou--right_png");this.scene.addChild(l),l.y=963,l.x=639},i.bindEvent=function(){this.btn1.touchEnabled=!0,this.btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){btn1(),this.createLayer()},this),this.btn2.touchEnabled=!0,this.btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;this.stage.removeChildren(),this.stage.addChild(this.scene),P2Scene.deadline=P2Scene.TIME,P2Scene.scene=new egret.DisplayObjectContainer,new P2Scene(P2Scene.scene,this.stage),this.scene.x=0,this.scene.y=0,TweenMax.to(this.scene,.6,{y:0,x:0,rotation:100,alpha:0,onComplete:function(){return e.stage.removeChild(e.scene)},ease:Back.easeInOut}),btn2()},this),this.btn3.touchEnabled=!0,this.btn3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){btn3(),document.location.href="http://zt.m.emao.com/bachelor"},this),this.logo.touchEnabled=!0,this.logo.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this,!0)},i.createBitmapByName=function(e){var t=new egret.Bitmap,i=RES.getRes(e);return t.texture=i,t},e.scene=new egret.DisplayObjectContainer,e}();egret.registerClass(P3Scene,"P3Scene");